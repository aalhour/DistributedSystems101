<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Distributed Systems 101</title>
<meta name="author" content="(@lvh)"/>

<link rel="stylesheet" href="./reveal.js/css/reveal.min.css"/>
<link rel="stylesheet" href="./reveal.js/css/theme/lvh.css" id="theme"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<h1>Distributed Systems 101</h1>
<h2>@lvh</h2>
<h2><a href="mailto:_@lvh.io">_@lvh.io</a></h2>
<h2></h2>
</section>

<section>
<section id="sec-1" >

<h2>Introduction</h2>
</section>
<section id="sec-1-1" >

<h3>Who am I?</h3>
<img src="./media/lvh.svg" alt="lvh.svg" style="width:80%" />

</section>
<section id="sec-1-2" >

<h3>Rackspace</h3>
<img src="./media/rackspace.svg" alt="rackspace.svg" style="width:90%" />

</section>
<section id="sec-1-3" >

<h3>AutoScale</h3>
<img src="./media/threeotters.jpg" alt="threeotters.jpg" style="width:90%" />

</section>
<section id="sec-1-4" >

<h3>AutoScale</h3>
<ul class="org-ul">
<li class="fragment roll-in">Distributed system
</li>
<li class="fragment roll-in">Manages distributed systems
</li>
<li class="fragment roll-in">Running on distributed systems
</li>
<li class="fragment roll-in">Interacting with distributed systems
</li>
</ul>

</section>
<section id="sec-1-5" >

<h3>Why this talk?</h3>
<p>
Parallels with Crypto 101
</p>

<ul class="org-ul">
<li class="fragment roll-in">Field considered exclusive domain of experts
</li>
<li class="fragment roll-in">Abstinence-only education doesn't work
</li>
<li class="fragment roll-in">Lots of material, but not organized for self-teaching
</li>
<li class="fragment roll-in">We can't afford not to care
</li>
</ul>

</section>
<section id="sec-1-6" >

<h3>Disconnect</h3>
<ul class="org-ul">
<li>Many theoreticians ignore practice
</li>
<li>Many practitioners ignore theory
</li>
</ul>

</section>
<section id="sec-1-7" >

<h3>Distributed Systems 101</h3>
<p>
"Just enough" distributed systems
</p>

<ul class="org-ul">
<li class="fragment roll-in">to whet your appetite
</li>
<li class="fragment roll-in">to shoot yourself in the foot
</li>
</ul>
</section>

</section>
<section>
<section id="sec-2" >

<h2>Distributed systems?</h2>
</section>
<section id="sec-2-1" >

<h3>What <i>is</i> a distributed system?</h3>
<blockquote nil>
<p>
[&#x2026;] when a machine I've never heard of can cause my program to
fail.
</p>
</blockquote>

<p>
<i>&#x2013; Leslie Lamport</i>
</p>

</section>
<section id="sec-2-2" >

<h3>Paradox</h3>
<ul class="org-ul">
<li>Why do we use them? Reliability!
</li>
<li>Experts' primary concern? Failure!
</li>
</ul>

</section>
<section id="sec-2-3" >

<h3>Fundamental constraints</h3>
<ol class="org-ol">
<li>Information travels at <i>c</i>
</li>
<li>Components fail
</li>
</ol>

</section>
<section id="sec-2-4" >

<h3>Fallacies</h3>
<ol class="org-ol">
<li>The network is reliable.
</li>
<li>Latency is zero.
</li>
<li>Bandwidth is infinite.
</li>
<li>The network is secure.
</li>
<li>Topology doesn't change.
</li>
<li>There is one administrator.
</li>
<li>Transport cost is zero.
</li>
<li>The network is homogeneous.
</li>
</ol>

</section>
<section id="sec-2-5" >

<h3>Examples of distributed systems</h3>
<ul class="org-ul">
<li>Basically everything (e.g., your laptop)
<ul class="org-ul">
<li>Speed of light isn't infinite
</li>
<li>RAM is <i>all the way over there</i>
</li>
</ul>
</li>
<li>Typically:
<ul class="org-ul">
<li>Any system with &gt; 1 machine
</li>
<li>Connected via network
</li>
</ul>
</li>
</ul>
</section>

</section>
<section>
<section id="sec-3" >

<h2>Bad news</h2>
<p>
Theory and consequences
</p>

</section>
<section id="sec-3-1" >

<h3>CAP theorem</h3>
</section>
<section id="sec-3-1-1" >

<h4>Pick any two:</h4>
<ul class="org-ul">
<li>Consistency
</li>
<li>Availability
</li>
<li>Partition tolerance
</li>
</ul>

</section>
<section id="sec-3-1-2" >

<h4>What does that even mean?</h4>
<ul class="org-ul">
<li>C: linearizability (~ local behavior)
</li>
<li>A: all active nodes answer every query
</li>
<li>P: failure resistance
</li>
</ul>

</section>
<section id="sec-3-1-3" >

<h4>Pick any two</h4>
<img src="./media/cap-venn-base.svg" alt="cap-venn-base.svg" style="width:50%" />

</section>
<section id="sec-3-1-4" >

<h4>Pick any two</h4>
<img src="./media/cap-venn-any2.svg" alt="cap-venn-any2.svg" style="width:50%" />

</section>
<section id="sec-3-1-5" >

<h4>Can't sacrifice partition tolerance</h4>
<ul class="org-ul">
<li>Partition tolerance is failure tolerance
</li>
<li>Networks, nodes fail all the time
</li>
<li>Latency happens; indistinguishable
</li>
<li>P(no failures) &lt; 1 - P(one node works)<sup>N</sup>
<ul class="org-ul">
<li>Cascades, Hurst exponent
</li>
</ul>
</li>
</ul>

</section>
<section id="sec-3-1-6" >

<h4>Pick any two: AP or CP</h4>
<img src="./media/cap-venn-any2-withp.svg" alt="cap-venn-any2-withp.svg" style="width:50%" />

</section>
<section id="sec-3-1-7" >

<h4>Example: Zookeeper</h4>
<ul class="org-ul">
<li>Zookeeper is CP
</li>
<li>Consistent ops that sometimes fail
</li>
</ul>

</section>
<section id="sec-3-1-8" >

<h4>Examples: Cassandra</h4>
<ul class="org-ul">
<li>Cassandra is AP
</li>
<li>inconsistent ops that (usually) succeed
</li>
</ul>

</section>
<section id="sec-3-1-9" >

<h4>Informally</h4>
<p>
Let's look at a 5 node cluster
</p>

</section>
<section id="sec-3-1-10" >

<h4>5-node connected cluster</h4>
<img src="./media/CAP/Connected.svg" alt="Connected.svg" style="width:50%" />

</section>
<section id="sec-3-1-11" >

<h4>What happens when stuff fails?</h4>
<p>
Idea: (N+1)/2 quorum
</p>

</section>
<section id="sec-3-1-12" >

<h4>Some failures</h4>
<img src="./media/CAP/Quorum.svg" alt="Quorum.svg" style="width:50%" />

</section>
<section id="sec-3-1-13" >

<h4>Failures are indistinguishable</h4>
<img src="./media/CAP/QuorumWithNodeFailures.svg" alt="QuorumWithNodeFailures.svg" style="width:50%" />

</section>
<section id="sec-3-1-14" >

<h4>Too many failures, no quorum</h4>
<img src="./media/CAP/NoQuorum.svg" alt="NoQuorum.svg" style="width:50%" />

</section>
<section id="sec-3-1-15" >

<h4>Simple quorum isn't enough</h4>
<img src="./media/CAP/DoubleQuorum.svg" alt="DoubleQuorum.svg" style="width:50%" />

</section>
<section id="sec-3-1-16" >

<h4>Back to reality</h4>
<ul class="org-ul">
<li>CAP's C is linearizability
</li>
<li>CAP's A is ops on <i>any</i> node
</li>
<li>These are very strong guarantees!
</li>
</ul>

</section>
<section id="sec-3-1-17" >

<h4>Gradations</h4>
<img src="./media/ap-cp.svg" alt="ap-cp.svg" style="width:80%" />

</section>
<section id="sec-3-1-18" >

<h4>Reality</h4>
<ul class="org-ul">
<li><i>Many</i> consistency models (real &amp; theoretical)
</li>
<li><i>Many</i> levels of availability (0-100%)
</li>
<li>No reason to sacrifice either outside of failures
</li>
<li>Systems can choose what to sacrifice (A vs C)
</li>
</ul>

</section>
<section id="sec-3-1-19" >

<h4>Example of creative sacrifice: <code>etcd</code></h4>
<ul class="org-ul">
<li>Normally: consistency all the way
</li>
<li>Option of doing inconsistent reads
</li>
<li>Maybe get some stale data
</li>
<li>&#x2026; but still works if the cluster is on fire!
</li>
</ul>

</section>
<section id="sec-3-1-20" >

<h4>What lives in those gray areas?</h4>

</section>
<section id="sec-3-1-21" >

<h4>Trade-offs</h4>
<table nil>
<tbody>
<tr>
<td class="left">Availability</td>
<td class="left">Consistency</td>
</tr>

<tr>
<td class="left">Performance</td>
<td class="left">Ease of reasoning</td>
</tr>

<tr>
<td class="left">Availability</td>
<td class="left">Transactionality</td>
</tr>

<tr>
<td class="left">Scalability</td>
<td class="left">Guarantees</td>
</tr>
</tbody>
</table>


</section>
<section id="sec-3-2" >

<h3>Consistency models</h3>
</section>
<section id="sec-3-2-1" >

<h4>One process, one register</h4>
<img src="./media/SimpleRegister.svg" alt="SimpleRegister.svg" style="width:70%" />

</section>
<section id="sec-3-2-2" >

<h4>Two processes, one register</h4>
<img src="./media/SimpleRegisterTwoWriters.svg" alt="SimpleRegisterTwoWriters.svg" />

</section>
<section id="sec-3-2-3" >

<h4>This is how we expect stuff to work</h4>
<p>
(We are a spoiled bunch)
</p>

</section>
<section id="sec-3-2-4" >

<h4>Information travels at <i>c</i></h4>
<img src="./media/SlowRegisters.svg" alt="SlowRegisters.svg" style="width:50%" />

</section>
<section id="sec-3-2-5" >

<h4>Slow stuff can overlap</h4>
<img src="./media/SlowOverlap.svg" alt="SlowOverlap.svg" style="width:90%" />

</section>
<section id="sec-3-2-6" >

<h4>Concurrency</h4>
<p>
Overlapping operations
</p>

</section>
<section id="sec-3-2-7" >

<h4>Consistency models</h4>
<img src="./media/ConsistencyModels.svg" alt="ConsistencyModels.svg" style="width:80%" />

<aside class="notes">
<p>
<a href="http://www.bailis.org/papers/hat-vldb2014.pdf">http://www.bailis.org/papers/hat-vldb2014.pdf</a>
<a href="http://www.ics.forth.gr/tech-reports/2013/2013.TR439_Survey_on_Consistency_Conditions.pdf">http://www.ics.forth.gr/tech-reports/2013/2013.TR439_Survey_on_Consistency_Conditions.pdf</a>
<a href="http://www.allthingsdistributed.com/2008/12/eventually_consistent.html">http://www.allthingsdistributed.com/2008/12/eventually_consistent.html</a>
</p>
</aside>

</section>
<section id="sec-3-2-8" >

<h4>Serializability</h4>
<ul class="org-ul">
<li>∃ serial execution with the same result
</li>
<li><i>Some</i> serial execution: fairly weak
<ul class="org-ul">
<li>No restrictions on <i>which</i> serial execution
</li>
<li>No restrictions on <i>when</i> they execute
</li>
</ul>
</li>
</ul>

</section>
<section id="sec-3-2-9" >

<h4>Example: serializability being weak</h4>
<p>
Precondition: <i>x = 0</i>
</p>

<ol class="org-ol">
<li><i>x ← 0</i>
</li>
<li><i>x ← 1</i>
</li>
<li><i>x ← 2</i>
</li>
</ol>

</section>
<section id="sec-3-2-10" >

<h4>Example: serializability being strong</h4>
<p>
Precondition: <i>x = y = 0</i>
</p>

<ol class="org-ol">
<li><i>y ← 2</i>, assuming <i>y = 1</i>
</li>
<li><i>x ← 1</i>, assuming <i>x = 0</i>
</li>
<li><i>y ← x</i>, assuming <i>x = 1</i>
</li>
</ol>

</section>
<section id="sec-3-2-11" >

<h4>Compare and set</h4>
<p>
Important primitive
</p>

</section>
<section id="sec-3-2-12" >

<h4>Linearizability</h4>
<p>
All operations appear to happen instantly
</p>

</section>
<section id="sec-3-2-13" >

<h4>Strong serializability</h4>
<ul class="org-ul">
<li>Linearizable &amp; serializable
</li>
<li>There is a serial execution &#x2026;
</li>
<li>&#x2026; and that execution is unique &amp; matches wallclock time (???)
</li>
</ul>

</section>
<section id="sec-3-2-14" >

<h4>Your computer is distributed</h4>
<p>
Models also exist in "centralized" systems
</p>

<ul class="org-ul">
<li>SQL databases
</li>
<li>Clojure's reference types
</li>
</ul>

</section>
<section id="sec-3-2-15" >

<h4>Twisted vs threads</h4>
<ul class="org-ul">
<li>Twisted: strongly serializable
<ul class="org-ul">
<li>Event loop with 1 reactor thread
</li>
<li>Serializable: reactor finds the ordering
</li>
<li>Linearizable: callbacks run by themselves
</li>
</ul>
</li>
<li>Threads: usually more like read uncommitted
<ul class="org-ul">
<li>Many Python opcodes are atomic
</li>
<li>Correct use of locks?
</li>
</ul>
</li>
</ul>

</section>
<section id="sec-3-3" >

<h3>FLP</h3>
</section>
<section id="sec-3-4" >

<h3>Wallclocks</h3>
</section>

</section>
<section>
<section id="sec-4" >

<h2>Good news</h2>
<p>
Stuff you <i>can</i> rely on
</p>

</section>
<section id="sec-4-1" >

<h3>Queues</h3>

</section>
<section id="sec-4-2" >

<h3>Consensus protocols</h3>
</section>
<section id="sec-4-2-1" >

<h4>Examples</h4>
<ul class="org-ul">
<li>ZAB (Zookeeper)
</li>
<li>Paxos* (Chubby)
</li>
<li>Raft (<code>etcd</code>)
</li>
</ul>

</section>
<section id="sec-4-3" >

<h3>Consensus protocol recipes</h3>
<ul class="org-ul">
<li>Set partitioning
</li>
<li>Consistent counters
</li>
<li>&#x2026;
</li>
</ul>

</section>
<section id="sec-4-3-1" >

<h4>Example</h4>

</section>
<section id="sec-4-4" >

<h3>CRDTs</h3>
<ul class="org-ul">
<li>Conflict-free
</li>
<li>Replicated
</li>
<li>Data
</li>
<li>Type
</li>
</ul>

</section>
<section id="sec-4-4-1" >

<h4>Problem</h4>
<ul class="org-ul">
<li>Read, compute, write back
</li>
<li>Concurrency: multiple results
</li>
<li>Conflicts!
</li>
</ul>

</section>
<section id="sec-4-4-2" >

<h4>Solutions?</h4>
<ul class="org-ul">
<li>Coordination?  Expensive! :-(
</li>
<li>I want highly available data stores&#x2026;
</li>
<li>&#x2026; but I don't want nonsense data
</li>
</ul>

</section>
<section id="sec-4-4-3" >

<h4>Idea!</h4>
<ul class="org-ul">
<li>Describe what you want
</li>
<li>Describe conflict resolution
</li>
</ul>

</section>
<section id="sec-4-4-4" >

<h4>Specializations</h4>
<p>
The C in CRDT can mean:
</p>

<ul class="org-ul">
<li>Commutative (CmRDT)
</li>
<li>Convergent (CvRDT)
</li>
</ul>

</section>
<section id="sec-4-4-5" >

<h4>Commutative RDTs</h4>
<ul class="org-ul">
<li>Broadcast operations
</li>
<li>Merge operation:
<ul class="org-ul">
<li>Commutative: <code>f(x, y) = f(y, x)</code>
</li>
<li>Not idempotent <code>f(x, y) != f(f(x, y), y)</code>
</li>
</ul>
</li>
</ul>

</section>
<section id="sec-4-4-6" >

<h4>Example: integers</h4>
<ul class="org-ul">
<li>+1, -2, +3, +5, -4 =&gt; +3
</li>
<li>Always get same answer:
<ul class="org-ul">
<li>As long as I see all ops <i>once</i>
</li>
<li>Duplicate an op, get wrong answer
</li>
<li>Order doesn't matter, though
</li>
</ul>
</li>
</ul>

</section>
<section id="sec-4-4-7" >

<h4>Convergent RDTs</h4>
<ul class="org-ul">
<li>Broadcast states
</li>
<li>Merge operation has many properties:
<ul class="org-ul">
<li>Commutative: <code>f(x, y) = f(y, x)</code>
</li>
<li>Idempotent: <code>f(x, y) = f(f(x, y), y)</code>
</li>
<li>Associative: <code>f(f(x, y), z) = f(x, f(y, z))</code>
</li>
<li>Informally: apply a bunch of times until done
</li>
</ul>
</li>
</ul>

</section>
<section id="sec-4-4-8" >

<h4>Simple CvRDT conflict resolution</h4>
<img src="./media/CvRDTMerge.svg" alt="CvRDTMerge.svg" />

</section>
<section id="sec-4-4-9" >

<h4>Complex CvRDT conflict resolution</h4>
<img src="./media/ComplexCvRDTMerge.svg" alt="ComplexCvRDTMerge.svg" />

</section>
<section id="sec-4-4-10" >

<h4>CRDTs in practice: usually CvRDT</h4>
<p>
Solve a hard local problem once
</p>

<p>
vs
</p>

<p>
Solve a hard distributed problem constantly
</p>

</section>
<section id="sec-4-4-11" >

<h4>Examples</h4>
<ul class="org-ul">
<li>Counters (G, PN)
</li>
<li>Sets (G, 2P, LWW, PN, OR)
</li>
<li>Maps (sets of <code>(k, v)</code> tuples)
</li>
<li>Graphs (using multiple sets)
</li>
<li>Registers (LWW, MV)
</li>
<li>Sequences (continuous, RGA)
</li>
</ul>

</section>
<section id="sec-4-4-12" >

<h4>Using CRDTs</h4>
<ul class="org-ul">
<li>Designing them is tricky
</li>
<li>Using them is fairly easy
</li>
</ul>

</section>
<section id="sec-4-4-13" >

<h4>Riak &lt;3</h4>
<ul class="org-ul">
<li>Flags
</li>
<li>Registers
</li>
<li>Counters
</li>
<li>Sets
</li>
<li>Maps
</li>
</ul>
</section>

</section>
<section>
<section id="sec-5" >

<h2>Wrap-up</h2>
</section>
<section id="sec-5-1" >

<h3>Yay, distributed systems!</h3>
<ul class="org-ul">
<li>More resilient
</li>
<li>More performant
</li>
<li>Make problems tractable
</li>
</ul>

</section>
<section id="sec-5-2" >

<h3>Argh, distributed systems!</h3>
<ul class="org-ul">
<li>Incredibly hard to reason about
</li>
<li>Huge state space, no repeat scenarios
</li>
<li>Expensive to operate
</li>
</ul>

</section>
<section id="sec-5-3" >

<h3>Why distributed systems?</h3>
<p>
Because you're <i>out of options</i>.
</p>

</section>
<section id="sec-5-4" >

<h3>Questions?</h3>
</section>
</section>
</div>
</div>

<script src="./reveal.js/lib/js/head.min.js"></script>
<script src="./reveal.js/js/reveal.min.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: true,
rollingLinks: false,
keyboard: true,
overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: './reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: './reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: './reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
]
});
</script>
</body>
</html>
